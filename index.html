<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
    <title>腾讯云视频点播示例</title>
    <link href="https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.1/tcplayer.min.css" rel="stylesheet" />
    <!--如果需要在 Chrome 和 Firefox 等现代浏览器中通过 H5 播放 Webrtc 视频，需要在 tcplayer.vx.x.x.min.js 之前引入 TXLivePlayer-x.x.x.min.js。-->
    <!--有些浏览器环境不支持 Webrtc，播放器会将 Webrtc 流地址自动转换为 HLS 格式地址，因此快直播场景同样需要引入hls.min.x.xx.xm.js。-->
    <script src="https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.1/libs/TXLivePlayer-1.2.0.min.js"></script>
    <!--如果需要在 Chrome 和 Firefox 等现代浏览器中通过 H5 播放 HLS 格式的视频，需要在 tcplayer.vx.x.x.min.js 之前引入 hls.min.x.xx.xm.js。-->
    <script src="https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.1/libs/hls.min.0.13.2m.js"></script>
    <!--播放器脚本文件-->
    <script src="https://web.sdk.qcloud.com/player/tcplayer/release/v4.5.1/tcplayer.v4.5.1.min.js"></script>

    <link rel="stylesheet" href="./lib/css/style.css">
    <script src="./lib/CommentCoreLibrary.js"></script>
    <style>
        .container {
            position: absolute;
            width: 700px;
            height: 342px;
            z-index: 1;
        }
    </style>
</head>

<body>
    <div class="abp">
        <div id="commentCanvas" class="container"></div>
        <!-- 设置播放器容器 -->
        <video id="player-container-id" preload="auto" width="700" height="392" playsinline webkit-playsinline
            x5-playsinline></video>
        <!--
            注意事项：
            * 播放器容器必须为 video 标签
            * player-container-id 为播放器容器的ID，可自行设置
            * 播放器区域的尺寸请按需设置，建议通过 css 进行设置，通过css可实现容器自适应等效果
            * playsinline webkit-playsinline x5-playsinline 这几个属性是为了在标准移动端浏览器不劫持视频播放的情况下实现行内播放，此处仅作示例，请按需使用
            -->
    </div>

    <script>
        var $ = function (e) { return document.getElementById(e); };
        var cm = null;
        var timer = 0;
        var isPlaying = false; // 视频播放状态
        var videoDuration = 0; // 视频时长

        var barrageList = [
            {
                "mode": 1,
                "text": "Hello World",
                "stime": 20,
                "size": 25,
                "color": 0xff0000
            },
            {
                "mode": 1,
                "text": "Hello World 333333",
                "stime": 30,
                "size": 25,
                "color": 0xff0000
            },
            {
                "mode": 1,
                "text": "Hello World 444",
                "stime": 40,
                "size": 25,
                "color": 0xff0000
            },
            {
                "mode": 1,
                "text": "Hello World 555",
                "stime": 50,
                "size": 25,
                "color": 0xff0000
            }
        ] // 弹幕列表

        var player = TCPlayer("player-container-id", { // player-container-id 为播放器容器ID，必须与html中一致
            fileID: "7447398157015849771", // 请传入需要播放的视频fileID 必须
            appID: "1256993030", // 请传入点播账号的子应用appID 必须
            autoplay: false //是否自动播放
            //其他参数请在开发文档中查看
        });

        player.on("loadedmetadata", function() { // 获取视频时长
            videoDuration = Math.floor(player.duration())
        })

        player.on("play", function (res) { //  开始播放
            if (cm != null) {
                timer = setInterval(function () {
                    cm.time(Math.round(player.currentTime() * 1000));
                }, 10);
            }
            cm.start();
        })
        player.on("pause", function () { // 暂停
           if(cm != null) {
               cm.stop();
               clearTimeout(timer)
           }
        })
     
         
        $("commentCanvas").addEventListener("click", function() { // 点击弹幕区域
           isPlaying = !isPlaying;
           if (isPlaying) {
               player.play();
           } else {
               player.pause();
           }
        })

        window.addEventListener("load", function () {
            cm = new CommentManager($("commentCanvas"))
            cm.init()

            cm.load(barrageList)
            cm.start()
            if (timer) {
                clearTimeout(timer)
            }
            cm.clear()
        })

    </script>
</body>

</html>